# 31game とは何か

2022年9月24日～25日の 📺 [Mathpower](https://live.nicovideo.jp/watch/lv338206772) で取り上げられたゲーム  

固く説明すると、 📖 [21game](https://en.wikipedia.org/wiki/Nim#The_21_game) の 21 を 31 にしたもの  

ゲームのジャンルは　📖 [Nim](https://en.wikipedia.org/wiki/Nim)（二ム）  
Nim のジャンルは 📖 [不偏ゲーム](https://cympfh.cc/aiura/game-nim#%E4%B8%8D%E5%81%8F%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B)

31game は細かく言うと、  

* 「普通のルール」
* 📖 [ミゼールゲーム](https://en.wikipedia.org/wiki/Mis%C3%A8re#Mis%C3%A8re_game)（貧困のゲーム）のルール

の２種類ある。あとで説明する  

Mathpower のタコ部屋の人たちは、広く知られた 31ゲーム ではなく、バリアント（変則ルール，ローカルルール）の方で調べている  

# Nim とは何か

**物**（例：マッチ棒，碁石，etc）が、**場**（例：机，床，etc）に１個以上あるとする。
**プレイヤー** は２人とする

先行プレイヤーが物を１つ以上取り除く。
後攻プレイヤーも物を１つ以上取り除く。
物の最後の１個を取らされた方が **負け**（『ミゼールルール』と呼ぶ）

👇 バリアント（変則ルール，ローカルルール）が　いくつも考えられる  

* 最後の１個を取った方が **勝ち**（何が通常なのか分からないが『通常のルール』と呼ぶ）
* 物の個数を制限する
* １度に取れる物の数を制限する
* 物を複数の **山**（ヒープ，Heap） に分ける

# ミゼールゲームとは何か

Nim で、敗者が１人決まったところで終わるもの  

# 「普通のルール」とは何か

Nim で、勝者が１人決まったところで終わるもの  

# タコ部屋で調べている 31game のバリアントルール（ローカルルール）は？

📄 [二日間通し企画 ~31ゲームに潜む未解決問題に挑戦!~ MATH POWER 2022 9/24-9/25](https://drive.google.com/file/d/1-wV8gQ-FeX5P4inHXbt8kLU3GkyLTTrb/view)  
の中の、 **31ゲームの仲間 ~制限石取りゲーム~** の、さらにルールを拡張した **サブトラクションゲーム** を調べている  

* 「普通のルール」とする
* 石を取っていく
* 最初の石の個数は可変
* 取れる石の数は「１，２，３」から選ぶだけでなく、「１，３，５」など色々なパターンを調べている

# サブトラクションゲームとは

よくあるルールでは、取れる石の数は「１，２，３」の３つの内から選べるが、  
この「１，２，３」のことを **サブトラクションセット** と呼んで、 `S = { 1, 2, 3 }` のように書く  

ここで、 `S` の内容を　`{ 1, 3, 5 }` でも `{ 2, 4, 6, 8 }` でも、好きな非負整数を入れて作ってもいい、としたものを  
**サブトラクションゲーム** と呼ぶ  

`1` が入ってないと 山の石に取れない余りが出ることがあるが、その場合は、取れなかった人の負けとする  

# 用語説明

## mex

📖 [mex ,最小除外数 (minimum exclusion)](https://cympfh.cc/aiura/game-nim#%E3%82%B0%E3%83%A9%E3%83%B3%E3%83%87%E3%82%A3%E6%95%B0)

(1) 非負整数をいくつか選んで、 T とする。例えば T は 0, 1, 2, 3 とする  
(2) T に含まれない非負整数のうち、最小のものを mex T と呼ぶ。この例では mex T は 4

練習

* T が 1, 2, 3 のとき、 mex T は 0
* T が 0, 1, 3 のとき、 mex T は 2

## グランディ数

非負整数。  
グランディ数の求め方はあとで説明する  

### グランディ数と必勝戦略

* 手番を持つ方（これから石を取る方）に、グランディ数が **非0の局面** が回ってきたら、手番を持つ方が手を抜かない（勝つ手を選び続ける）限り 必勝だ。  
* 手番を持つ方に、グランディ数が **0の局面** が回ってきたら、相手（Opponent）が手を抜かない限り 必敗だ。  
* 相手に、グランディ数が **非0の局面** を回したら、相手が手を抜かない限り 手番を持つ方は必敗だ。  
* 相手に、グランディ数が **0の局面** を回したら、手番を持つ方が手を抜かない限り 必勝だ  

つまり、両者に、グランディ数を計算する能力があり、手を抜かなければ、対局開始時点で グランディ数を確認すれば、勝敗は決定している  

* ただし、この法則は、千日手の有るゲームを想定していない

ここで、必勝戦略は以下のようになる  

* 自分に グランディ数 非0 の局面が回ってきたら、相手に常に グランディ数 0 の局面を回す
* 自分に グランディ数 0 の局面が回ってきたら、相手が必勝手順から外れることを期待して 粘る 

### グランディ数の説明

`S={1,2,3}` のゲームのときの、グランディ数について説明する  

```plaintext
手番から見た机の上
┌───────┐
│       │
│       │
│       │
└───────┘
石の数が 0 個のとき、グランディ数は 0
手番なら： 負けている
相手なら： さっきの自分の手番で勝った
```

```plaintext
手番から見た机の上
┌───────┐
│       │
│    o  │
│       │
└───────┘
石の数が 1 個のとき、グランディ数は 1
手番なら： １つ取って勝ち
相手なら： 回ってこない。負け
```

```plaintext
手番から見た机の上
┌───────┐
│       │
│  o o  │
│       │
└───────┘
石の数が 2 個のとき、グランディ数は 2
手番なら： 自分が手を抜かなければ、２つ取って勝ち
相手なら： 手番を持つ方が手を抜かなければ、回ってこない。負け
```

```plaintext
手番から見た机の上
┌───────┐
│       │
│  o o  │
│   o   │
└───────┘
石の数が 3 個のとき、グランディ数は 3
手番なら： 自分が手を抜かなければ、３つ取って勝ち
相手なら： 手番を持つ方が手を抜かなければ、回ってこない。負け
```

```plaintext
手番から見た机の上
┌───────┐
│   o   │
│  o o  │
│   o   │
└───────┘
石の数が 4 個のとき、グランディ数は 0
手番なら： どう石を取っても、石が残る。相手が手を抜かなければ負け
相手なら： 手番を持つ方が石をどう残しても、全部取る方法あり。自分が手を抜かなければ自分の勝ち
```

```plaintext
手番から見た机の上
┌───────┐
│   o   │
│  o o  │
│   o o │
└───────┘
石の数が 5 個のとき、グランディ数は 1
手番なら： 石を２つか３つ取れば、机の上に石が４つ残るということはない。以降、自分が手を抜かなければ勝ち
相手なら： 手番を持つ方が石を１つだけ取るでもなければ、机の上に石が４つ残るということはない。手番を持つ方が手を抜かなければ負け
```

```plaintext
手番から見た机の上
┌───────┐
│   o   │
│  o o  │
│ o o o │
└───────┘
石の数が 6 個のとき、グランディ数は 2
手番なら： 石を１つか３つ取れば、机の上に石が４つ残るということはない。以降、自分が手を抜かなければ勝ち
相手なら： 手番を持つ方が石を２つ取るでもなければ、机の上に石が４つ残るということはない。手番を持つ方が手を抜かなければ負け
```

```plaintext
手番から見た机の上
┌───────┐
│   o o │
│  o o  │
│ o o o │
└───────┘
石の数が 7 個のとき、グランディ数は 3
手番なら： 石を１つか２つ取れば、机の上に石が４つ残るということはない。以降、自分が手を抜かなければ勝ち
相手なら： 手番を持つ方が石を３つ取るでもなければ、机の上に石が４つ残るということはない。手番を持つ方が手を抜かなければ負け
```

```plaintext
手番から見た机の上
┌───────┐
│ o o o │
│  o o  │
│ o o o │
└───────┘
石の数が 8 個のとき、グランディ数は 0
手番なら： どう石を取っても、５つ～７つの石が残る。相手には残りの石の数を４つにする方法がある。相手が手を抜かなければ負け
相手なら： 手番を持つ方が石をどう残しても、自分には残りの石の数を４つにする方法あり。自分が手を抜かなければ自分の勝ち
```

以下は、表にしたものだ  

|              |      |      |      |      |      |      |      |      |
| ------------ | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: |
| 残りの石の数 |    0 |    1 |    2 |    3 |    4 |    5 |    6 |    7 |
| グランディ数 |    0 |    1 |    2 |    3 |    0 |    1 |    2 |    3 |

サブトラクションセットと、残りの石の数　に対して、対応するグランディ数は決まる  

### グランディ数の求め方

まず用語を説明する  

* **非負整数** とは、 `0, 1, 2, 3, 4, ...` のように増えていく数列に含まれる数を言う

* **遷移** （せんい，Transition） とは、ここでは、 `今、目の前に残っている石` から、いくつか石を取ったら `石を取った残りの石` に変わった、というような意味だ

👇 例えば以下のとき

```plaintext
手番を持つ方から見た机の上
┌───────┐
│   o   │
│  o o  │
│ o o o │
└───────┘
石の数が６個
```

`S = { 1, 2, 3 }` のゲームでは、遷移先は３つある（位置ではなく、個数だけに注目）  

```plaintext
↓ 石を１つ取った   ↓ 石を２つ取った  ↓ 石を３つ取った

┌───────┐        ┌───────┐        ┌───────┐
│   o   │        │   o   │        │       │
│  o o  │        │  o o  │        │  o o  │
│ o o   │        │   o   │        │   o   │
└───────┘        └───────┘        └───────┘
石の数が５個       石の数が４個      石の数が３個
```

👇 遷移をまとめるとグラフになる。次に示す  

```plaintext
                                                                                先3                                          ┌─────┐
                                                                                後3 -----------------------------------┬---> │ 1個 │
                  ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │ 7個 │ 後3 ------------------------------------┬---> │ 4個 │ 先2                                     │         先1
│ 8個 │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │ 6個 │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                                  │                |                │            後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │ 3個 │ 先3    │                          │ 0個 │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │
                                          後1 ----┤           先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │ 5個 │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │                  │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │ 2個 │ 後2────┘
                                                                                                             └─────┘
```

次に グランディ数の求め方を示す  

👇 まず、石が0個の局面(★)のグランディ数を 0 とする

```plaintext
                                                                                先3                                          ┌─────┐
                                                                                後3 -----------------------------------┬---> │     │
                  ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │     │ 後3 ------------------------------------┬---> │     │ 先2                                     │         先1
│     │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │     │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                                  │                |                │            後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │     │ 先3    │                          │ 0  │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │        ★
                                          後1 ----┤           先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │     │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │                  │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │     │ 後2────┘
                                                                                                             └─────┘
```

👇 石が1個の局面(★)は、非負整数から、隣接する遷移先(◆)のグランディ数を除外し、残った非負整数の最小の数を入れる  

```plaintext
                                                                                先3                                          ┌─────┐
                                                                                後3 -----------------------------------┬---> │  1  │ ★
                  ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │     │ 後3 ------------------------------------┬---> │     │ 先2                                     │         先1
│     │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │     │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                                  │                |                │            後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │     │ 先3    │                          │ 0  │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │         ◆
                                          後1 ----┤           先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │     │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │                  │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │     │ 後2────┘
                                                                                                             └─────┘
```

👇 石が2個の局面(★)は、非負整数から、隣接する遷移先(◆)のグランディ数を除外し、残った非負整数の最小の数を入れる  

```plaintext
                                                                                先3                                          ┌─────┐
                                                                                後3 -----------------------------------┬---> │  1  │ ◆
                  ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │     │ 後3 ------------------------------------┬---> │     │ 先2                                     │         先1
│     │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │     │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                                  │                |                │            後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │     │ 先3    │                          │ 0  │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │         ◆
                                          後1 ----┤           先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │     │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │      ★           │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │  2  │ 後2────┘
                                                                                                             └─────┘
```

👇 石が3個の局面(★)は、非負整数から、隣接する遷移先(◆)のグランディ数を除外し、残った非負整数の最小の数を入れる  

```plaintext
                                                                                先3                                          ┌─────┐
                                                                                後3 -----------------------------------┬---> │  1  │ ◆
                  ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │     │ 後3 ------------------------------------┬---> │     │ 先2                                     │         先1
│     │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │     │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                                  │                |                │      ★    後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │  3  │ 先3    │                          │ 0  │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │         ◆
                                          後1 ----┤           先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │     │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │      ◆           │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │  2  │ 後2────┘
                                                                                                             └─────┘
```

👇 石が4個の局面(★)は、非負整数から、隣接する遷移先(◆)のグランディ数を除外し、残った非負整数の最小の数を入れる  

```plaintext
                                                                                先3                                          ┌─────┐
                                                                          ★    後3 -----------------------------------┬---> │  1  │ ◆
                  ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │     │ 後3 ------------------------------------┬---> │  0  │ 先2                                     │         先1
│     │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │     │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                                  │                |                │      ◆    後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │  3  │ 先3    │                          │ 0  │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │
                                          後1 ----┤           先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │     │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │      ◆           │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │  2  │ 後2────┘
                                                                                                             └─────┘
```

👇 石が5個の局面(★)は、非負整数から、隣接する遷移先(◆)のグランディ数を除外し、残った非負整数の最小の数を入れる  

```plaintext
                                                                                先3                                          ┌─────┐
                                                                          ◆     後3 -----------------------------------┬---> │  1  │
                  ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │     │ 後3 ------------------------------------┬---> │  0  │ 先2                                     │         先1
│     │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │     │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                                  │                |                │      ◆    後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │  3  │ 先3    │                          │ 0  │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │
                                          後1 ----┤      ★   先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │  1  │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │      ◆           │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │  2  │ 後2────┘
                                                                                                             └─────┘
```

👇 石が6個の局面(★)は、非負整数から、隣接する遷移先(◆)のグランディ数を除外し、残った非負整数の最小の数を入れる  

```plaintext
                                                                                先3                                          ┌─────┐
                                                                          ◆     後3 -----------------------------------┬---> │  1  │
                  ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │     │ 後3 ------------------------------------┬---> │  0  │ 先2                                     │         先1
│     │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │  2  │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                     ★           │                |                │       ◆    後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │  3  │ 先3    │                          │ 0  │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │
                                          後1 ----┤      ◆    先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │  1  │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │                   │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │  2  │ 後2────┘
                                                                                                             └─────┘
```

👇 石が7個の局面(★)は、非負整数から、隣接する遷移先(◆)のグランディ数を除外し、残った非負整数の最小の数を入れる  

```plaintext
                                                                                先3                                          ┌─────┐
                     ★                                                   ◆     後3 -----------------------------------┬---> │  1  │
                  ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │  3  │ 後3 ------------------------------------┬---> │  0  │ 先2                                     │         先1
│     │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │  2  │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                     ◆            │                |                │            後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │  3  │ 先3    │                          │ 0  │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │
                                          後1 ----┤      ◆    先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │  1  │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │                   │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │  2  │ 後2────┘
                                                                                                             └─────┘
```

👇 石が8個の局面(★)は、非負整数から、隣接する遷移先(◆)のグランディ数を除外し、残った非負整数の最小の数を入れる  

```plaintext
                                                                                先3                                          ┌─────┐
                     ◆                                                          後3 -----------------------------------┬---> │  1  │
   ★             ┌─────┐                                              ┌─────┐                                         │     └─────┘
┌─────┐  先1 -->  │  3  │ 後3 ------------------------------------┬---> │  0  │ 先2                                     │         先1
│  0  │           └─────┘ 後2 --------------------┐               │     └─────┘ 後2 ─────────────────────┐              │        後1
└─────┘                   後1 ---> ┌─────┐        │               │                                     │               │         │
         先2 --------------------> │  2  │ 先2     │               │           先1                       │              │          │
                                   └─────┘ 後2--- │ --------------┘            後1---┐           先2     │              │          │
                                     ◆            │                |                │            後2 -- │ --------------┘         ↓
                                           先3    │                |                │    ┌─────┐        │               │         ┌─────┐
                                           後3--- │ ---------------------------------┬-> │  3  │ 先3    │                          │ 0  │
                                                  │                |                 |   └─────┘ 後3 -- │ ─────────────────┼────> └─────┘
                                          先1     │                |                 |                  │                  │
                                          後1 ----┤      ◆    先1  |                 |          先1     │               │   │
                                                  │   ┌─────┐ 後1--┘                 |          後1 ----┤               │   │
         先3 -------------------------------------┴-> │  1  │                        |                  │               │   │
                                                      └─────┘ 先2                    |                  │            先1│   │
                                                              後2--------------------┘                  │            後1┘   │
                                                                                                        │                   │
                                                              先3                                       │    ┌─────┐ 先2    │
                                                              後3---------------------------------------┴--> │  2  │ 後2────┘
                                                                                                             └─────┘
```

以下同様  

## tail length （尻尾の長さ）

`1 2 3 4 5 6 4 5 6 4 5 6 ...`  

という数があり、 `4 5 6` で循環しているとき、  
循環に入る前の `1 2 3` の部分が尻尾で、その要素数 3 が tail length  

# 関連する記事

📖 [o31game](https://github.com/muzudho/o31game/tree/main/me) - 遊んで覚えるPythonプログラム  
📖 [グランディ数列の探索プログラム](https://ack61.github.io/mathpower2022-31game/) - Ackvy さんの電卓

EOF
